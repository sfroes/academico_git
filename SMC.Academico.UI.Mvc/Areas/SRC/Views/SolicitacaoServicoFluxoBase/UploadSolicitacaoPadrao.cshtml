@using SMC.Formularios.UI.Mvc;
@using SMC.Academico.Common.Areas.SRC.Constants;

@model SMC.Academico.UI.Mvc.Areas.SRC.Models.UploadSolicitacaoPadraoPaginaViewModel

@{
    Layout = "~/Views/Shared/_LayoutFluxo.cshtml";
}

@section MenuFluxo {
    @Html.Action("MenuFluxo", Model)
}

@(Smc.SGFTemplate().Secao().Token(TOKEN_SOLICITACAO_SERVICO.SECAO_TEXTO_UPLOAD))

@(Smc.SGFTemplate().Secao().Token(TOKEN_SOLICITACAO_SERVICO.SECAO_ARQUIVO_UPLOAD))

@using (Smc.Form("frmPagina").Ajax().Begin())
{

    @(Smc.Legend("legenda", SMCOrientation.Horizontal).CssClass("smc-sga-legenda")
            .Items(new List<SMCLegendItem>()
            {
                new SMCLegendItem() {
                CssClass = "smc-legenda-status-aguardandoentrega",
                Description = SMC.Academico.Common.Areas.SRC.Enums.SituacaoEntregaDocumentoAluno.AguardandoRegistroDocumento.SMCGetDescription()
                },
                new SMCLegendItem()
                {
                CssClass = "smc-legenda-status-deferido",
                Description = SMC.Academico.Common.Areas.SRC.Enums.SituacaoEntregaDocumentoAluno.RegistroDocumentoOK.SMCGetDescription()
                }
            })
    )

    if (Model.DocumentosObrigatorios != null && Model.DocumentosObrigatorios.Any())
    {
        using (Smc.Fieldset("obrigatorios").Begin())
        {
            @(Smc.ButtonSet()
                    .AddButton(Smc.Button(SMCMvcConsts.MODAL_BEHAVIOR_OPEN)
                    .Action("RegistrarDocumentos", null, new
                    {
                        @seqSolicitacaoServico = Model.SeqSolicitacaoServico,
                        @seqConfiguracaoEtapa = (SMC.Framework.UI.Mvc.SMCEncryptedLong)Model.SeqConfiguracaoEtapa,
                        @backUrl = Url.Action("EntrarEtapa", null, new { @SeqSolicitacaoMatricula = new SMCEncryptedLong(Model.SeqSolicitacaoServico), @SeqConfiguracaoEtapa = new SMCEncryptedLong(Model.SeqConfiguracaoEtapa) }),
                        @area = string.Empty,
                        @seqPessoaAtuacao = Model.SeqPessoaAtuacao,
                        @grupoObrigatorio = true
                    })
                    .Ajax(isPost: false)
                    .CssClass("smc-sga-btn-inline")
                    .SecurityToken(UC_SRC_004_06_01.ABERTURA_SOLICITACAO_UPLOAD_ARQUIVOS)
                    .Attribute(SMCMvcConsts.MODAL_ID, "modalRegistrarDocumentos")
                    .Attribute(SMCMvcConsts.MODAL_TITLE, Smc.GetUIResource("Modal_Title_Anexar_Documentos"))
                    .Text(Smc.GetUIResource("Label_Anexar_Documentos"))
                    .Tooltip(Smc.GetUIResource("Label_Anexar_Documentos"))
                )
            )
            @Html.Partial(Smc.GetExternalView(SMC.Academico.UI.Mvc.AcademicoExternalViews._REGISTRAR_REGISTRAR_DOC_ITEM), Model.DocumentosObrigatorios)
        }
    }

    if (Model.GruposDocumentosObrigatorios != null && Model.GruposDocumentosObrigatorios.Any())
    {
        foreach (var grupo in Model.GruposDocumentosObrigatorios)
        {
            TempData["__GrupoDocumentoObrigatorio"] = grupo.Key;
            using (Smc.Fieldset("grupoObrigatorios_" + grupo.Key.Seq).LegendText(grupo.Key.Descricao).CssClass("smc-sga-fieldset-secundario").Begin())
            {
                @(Smc.ButtonSet()
                    .AddButton(Smc.Button(SMCMvcConsts.MODAL_BEHAVIOR_OPEN)
                    .Action("RegistrarDocumentos", null, new
                    {
                        @seqSolicitacaoServico = Model.SeqSolicitacaoServico,
                        @seqConfiguracaoEtapa = (SMC.Framework.UI.Mvc.SMCEncryptedLong)Model.SeqConfiguracaoEtapa,
                        @backUrl = Url.Action("EntrarEtapa", null, new { @SeqSolicitacaoMatricula = new SMCEncryptedLong(Model.SeqSolicitacaoServico), @SeqConfiguracaoEtapa = new SMCEncryptedLong(Model.SeqConfiguracaoEtapa) }),
                        @area = string.Empty,
                        @seqPessoaAtuacao = Model.SeqPessoaAtuacao,
                        @grupoDocumento = new SMCEncryptedLong(grupo.Key.Seq)
                    })
                    .Ajax(isPost: false)
                    .CssClass("smc-sga-btn-inline")
                    .SecurityToken(UC_SRC_004_06_01.ABERTURA_SOLICITACAO_UPLOAD_ARQUIVOS)
                    .Attribute(SMCMvcConsts.MODAL_ID, "modalRegistrarDocumentos")
                    .Attribute(SMCMvcConsts.MODAL_TITLE, Smc.GetUIResource("Modal_Title_Anexar_Documentos"))
                    .Text(Smc.GetUIResource("Label_Anexar_Documentos"))
                    .Tooltip(Smc.GetUIResource("Label_Anexar_Documentos"))
                    )
                )

                @Html.Partial(Smc.GetExternalView(SMC.Academico.UI.Mvc.AcademicoExternalViews._REGISTRAR_REGISTRAR_DOC_ITEM_SOLICITACAO_PADRAO), grupo.Value)
            }
        }
    }

    if (Model.DocumentosOpcionais != null && Model.DocumentosOpcionais.Any())
    {
        using (Smc.Fieldset("opcionais").Begin())
        {
            @(Smc.ButtonSet()
                .AddButton(Smc.Button(SMCMvcConsts.MODAL_BEHAVIOR_OPEN)
                .Action("RegistrarDocumentos", null, new
                {
                    @seqSolicitacaoServico = Model.SeqSolicitacaoServico,
                    @seqConfiguracaoEtapa = (SMC.Framework.UI.Mvc.SMCEncryptedLong)Model.SeqConfiguracaoEtapa,
                    @backUrl = Url.Action("EntrarEtapa", null, new { @SeqSolicitacaoMatricula = new SMCEncryptedLong(Model.SeqSolicitacaoServico), @SeqConfiguracaoEtapa = new SMCEncryptedLong(Model.SeqConfiguracaoEtapa) }),
                    @area = string.Empty,
                    @seqPessoaAtuacao = Model.SeqPessoaAtuacao
                })
                .Ajax(isPost: false)
                .CssClass("smc-sga-btn-inline")
                .SecurityToken(UC_SRC_004_06_01.ABERTURA_SOLICITACAO_UPLOAD_ARQUIVOS)
                .Attribute(SMCMvcConsts.MODAL_ID, "modalRegistrarDocumentos")
                .Attribute(SMCMvcConsts.MODAL_TITLE, Smc.GetUIResource("Modal_Title_Anexar_Documentos"))
                .Text(Smc.GetUIResource("Label_Anexar_Documentos"))
                .Tooltip(Smc.GetUIResource("Label_Anexar_Documentos"))
            )
            )
            @Html.Partial(Smc.GetExternalView(SMC.Academico.UI.Mvc.AcademicoExternalViews._REGISTRAR_REGISTRAR_DOC_ITEM), Model.DocumentosOpcionais)
        }
    }

    @Html.Partial("_BotoesNavegacao", Model)
}

@using (Smc.ModalWindow("modalRegistrarDocumentos")
        .Form("frmRegistrar", "SalvarRegistroDocumentos", null, new { area = string.Empty }, closeOnSubmit: true, config: x => x.Ajax())
        .Size(SMCModalWindowSize.Largest)
        .Button(SMCButtonBehavior.Salvar, "SalvarRegistroDocumentos", null, new { area = string.Empty }, config: bnt => bnt.DisplayMode(SMCButtonDisplayMode.TextAndIcon).Highlight())
        .Button(SMCButtonBehavior.Fechar, config: bnt => bnt.DisplayMode(SMCButtonDisplayMode.TextAndIcon))
        .Begin()) { }