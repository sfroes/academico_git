@using SMC.Academico.UI.Mvc.Areas.SRC.Models;

@model InstrucoesFinaisSolicitacaoPadraoPaginaViewModel

@{
    Layout = "~/Views/Shared/_LayoutFluxo.cshtml";
}

@section MenuFluxo {
    @Html.Action("MenuFluxo", Model)
}

@(Smc.SGFTemplate().Secao().Token(TOKEN_SOLICITACAO_SERVICO.SECAO_TEXTO_INSTRUCOES_FINAIS))

@(Smc.SGFTemplate().Secao().Token(TOKEN_SOLICITACAO_SERVICO.SECAO_ARQUIVO_INSTRUCOES_FINAIS))

@using (Smc.Fieldset("fsSolicitacao").Begin())
{
    @Smc.DisplayFor(x => x.SituacaoAtualSolicitacao);
    if (!string.IsNullOrEmpty(Model.ObservacaoSituacaoAtual))
    {
        @Smc.DisplayFor(x => x.ObservacaoSituacaoAtual)
    }

    using (Smc.Fieldset("fsDescricaoOriginal").Begin())
    {
        @Smc.DisplayFor(x => x.DescricaoOriginal).HideLabel();
    }

    if (!string.IsNullOrEmpty(Model.DescricaoAtualizada))
    {
        using (Smc.Fieldset("fsDescricaoAtualizada").Begin())
        {
            @Smc.DisplayFor(x => x.DescricaoAtualizada).HideLabel();
        }
    }
}

@if (Model.Taxas != null && Model.Taxas.Any())
{
    using (Smc.Fieldset("fsTaxas").Begin())
    {
        @(Smc.Grid("gridTaxas_" + Guid.NewGuid().ToString(), new SMCPagerModel<TaxasSolicitacaoViewModel>(Model.Taxas))
                                                                            .HideGridTitle()
                                                                            .Size(SMCSize.Grid24_24)
                                                                            .AutoHideNavigator()
                                                                            .HideNavigator()
                                                                            .HideNumberOfRowsPerPageSelector()
                                                                            .HidePager()
                                                                            .HideRowsTotalizer()
                                                                            .FieldColumn(x => x.DescricaoTaxa)
                    .ButtonColumn(SMCButtonSetType.Secondary, 1, null, null, "smc-size-md-3 smc-size-xs-3 smc-size-sm-3 smc-size-lg-3", false,
                                  f => Smc.Button("GerarBoleto")
                                    .CssClass("smc-sga-botao-boleto")
                                    .Type(SMCButtonType.Link)
                                    .Tooltip(Smc.GetUIResource("Botao_Gerarboleto"))
                                    .SecurityToken()
                                    .Attribute("target", "_blank")
                                    .Enabled((f as TaxasSolicitacaoViewModel).HabilitarBotaoEmitirBoleto)
                                    .ButtonInstructions(Smc.GetUIResource((f as TaxasSolicitacaoViewModel).MensagemBotaoEmitirBoleto))
                                    .Action("EmissaoBoletoGerar", "ProcessoSolicitacao", new { seqTitulo = new SMCEncryptedLong((f as TaxasSolicitacaoViewModel).SeqTituloGra), seqTaxa = new SMCEncryptedLong((f as TaxasSolicitacaoViewModel).SeqTaxaGra), seqServico = new SMCEncryptedLong((f as TaxasSolicitacaoViewModel).SeqServico), seqSolicitacaoServico = new SMCEncryptedLong((f as TaxasSolicitacaoViewModel).SeqSolicitacaoServico), seqConfiguracaoEtapa = new SMCEncryptedLong((f as TaxasSolicitacaoViewModel).SeqConfiguracaoEtapa), Area = "SRC" }))              
                    .CssClass("smc-sga-alinhamento-botao-secundario")
        )
    }
}

@if (Model.ExigeJustificativa)
{
    using (Smc.Fieldset("fsJustificativa").Begin())
    {
        @Smc.DisplayFor(x => x.SeqJustificativa)
        @Smc.DisplayFor(x => x.ObservacoesJustificativa)
    }
}

@*@if (Model.ExigeFormulario)
    {
        foreach (var item in Model.DadoFormulario)
        {
            var nomeFormulario = Model.NomesFormularios.FirstOrDefault(x => x.Key == item.SeqFormulario).Value;

            using (Smc.Fieldset("fsFormulario_" + item.SeqFormulario).LegendText(nomeFormulario).Begin())
            {
                @Html.Partial("_InstrucoesFinaisSolicitacaoPadraoFormulario", item)
            }
        }
    }*@

@if (Model.Documentos != null && Model.Documentos.Any())
{
    using (Smc.Fieldset("fsDocumento").Begin())
    {
        @(Smc.Grid("gridDocumentos_" + Guid.NewGuid().ToString(), new SMCPagerModel<DocumentosSolicitacaoViewModel>
           (Model.Documentos))
           .HideGridTitle()
           .Size(SMCSize.Grid24_24)
           .AutoHideNavigator()
           .HideNavigator()
           .HideNumberOfRowsPerPageSelector()
           .HidePager()
           .HideRowsTotalizer()
           .FieldColumn(x => x.DescricaoTipoDocumento)
           .FieldColumn(x => x.Observacao)
           .ButtonColumn(SMCButtonSetType.Secondary, 1, null, null, null, false,
           x =>
           {
           var itemParsed = x as DocumentosSolicitacaoViewModel;
           return Smc.Button(SMCButtonBehavior.Visualizar).Enabled(itemParsed.ArquivoAnexado != null).Attribute("data-behavior-download", "true").Attribute("target", "_blank").DisplayMode(SMCButtonDisplayMode.Icon).Action("DownloadDocumentoGuid", "Matricula", new { @Area = "MAT", @guidFile = itemParsed.ArquivoAnexado != null ? itemParsed.ArquivoAnexado.GuidFile : Guid.NewGuid().ToString() });
           }
           ))

    }
}

@{
    var buttonSet = Smc.ButtonSet().CssClass("smc-sga-matricula-linha-botoes").Size(SMCSize.Grid24_24);

    buttonSet.AddButton(Smc.Button("sairProcesso")
                    .Id("sairProcesso")
                    .Type(SMCButtonType.Link)
                    .Action("Index", "SolicitacaoServico", new { area = "SRC" })
                    .CssClass("smc-btn-proximo-icotext-destaque"));

    buttonSet.AddButton(Smc.Button(SMCButtonBehavior.Imprimir, "ImprimirDadosSolicitacaoPadrao", new { seqSolicitacaoServico = new SMCEncryptedLong(Model.SeqSolicitacaoServico), seqConfiguracaoEtapa = new SMCEncryptedLong(Model.SeqConfiguracaoEtapa), seqServico = new SMCEncryptedLong(Model.SeqServico) })
                        .Type(SMCButtonType.Link)
                        .SecurityToken()
                        .CssClass("smc-btn-imprimir-icotext")
                        .Attribute("target", "_blank"));

    @buttonSet;
}
